<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>CloudBoost Admin Analytics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/controlfrog.css" rel="stylesheet" media="screen">
	<!--<link href="http://leapfrogui.com/controlfrog-v1.4/cf/favicon.ico" rel="shortcut icon" type="image/x-icon" />-->
    
    <!--[if lt IE 9]>
		<script src="../js/respond.min.js"></script>
		<script src="../js/excanvas.min.js"></script>
	<![endif]-->  
	
</head>
<body class="black">
	
	<div class="cf-nav cf-nav-state-min">
		<a href="#" class="cf-nav-toggle">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</a>
		
		<ul>
			<li class="cf-nav-shortcut">
				<a href="index.html">
					<span class="cf-nav-min">1</span>
					<span class="cf-nav-max">Last Week Data</span>
				</a>
			</li>
		</ul>
	</div>
	
	<div class="cf-container cf-nav-active">
		<div class="row">
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Total API Count</p>
				</header>
				<div class="content">
					<div class="cf-svmc-sparkline">
						<div class="cf-svmc">
							<div class="metric" id="apiCount">-</div>
							<div class="change m-green metric-small">
							</div>
						</div>
						
					</div>
				</div>
			</div> <!-- //end cf-item -->

            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>API Count - Last 7 days.</p>
                </header>
                <div class="content">
                    <div class="cf-svmc-sparkline">
                        <div class="cf-svmc">
                            <div class="metric" id="lastWeekAPI">-</div>
                            <div class="change m-green metric-small">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div> <!-- //end cf-item -->
                <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>API GROWTH RATE - LAST WEEK</p>
                </header>
                <div class="content">
                    <div class="cf-svmc-sparkline">
                        <div class="cf-svmc">
                            <div class="metric" id="apiGrowthRate">-</div>
                            <div class="change m-green metric-small">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div> <!-- //end cf-item -->
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>Method Wise Stats Last Week</p>
                </header>
                <div class="content cf-svp clearfix" id="svp-1">
                </div>
            </div>
           
        </div>
        <div class="row">
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>TOTAL COMPLETED FUNNEL APP COUNT</p>
                </header>
                <div class="content">
                    <div class="cf-svmc">
                        <div class="metric" id="funnelCount">-</div>
                    </div>
                </div>
            </div> <!-- //end cf-item -->
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>LAST WEEK FUNNEL APP COUNT</p>
                </header>
                <div class="content">
                    <div class="cf-svmc">
                        <div class="metric" id="lastWeekFunnelCount">-</div>
                    </div>
                </div>
            </div> <!-- //end cf-item -->
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>LAST WEEK FUNNEL APPS GROWTH RATE</p>
                </header>
                <div class="content">
                    <div class="cf-svmc-sparkline">
                        <div class="cf-svmc">
                            <div class="metric" id="funnelGrowthRate">-</div>
                            </div>
                        </div>
                    </div>
                </div>
        </div> <!-- //end row -->
        <div class="row">
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>TOTAL APPS</p>
                </header>
                <div class="content">
                    <div class="cf-svmc">
                        <div class="metric" id="totalApps">-</div>
                    </div>
                </div>
            </div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Active Apps last week.</p>
				</header>
				<div class="content">
					<div class="cf-svmc">
						<div class="metric" id="activeApps">-</div>
					</div>
				</div>
			</div> <!-- //end cf-item -->
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>ACTIVE APPS GROWTH RATE - LAST WEEK</p>
                </header>
                <div class="content">
                    <div class="cf-svmc-sparkline">
                        <div class="cf-svmc">
                            <div class="metric" id="appGrowthRate">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>Top Active Apps</p>
                </header>
                <div class="content">
                    <div id="cf-funnel-1" class="cf-funnel"></div>
                </div>
            </div> <!-- //end cf-item -->
            
		</div> <!-- //end row -->


        <!--ROW-->
        <div class="row">
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>TOTAL APPS(5000) </p>
                </header>
                <div class="content">
                    <div class="cf-svmc">
                        <div class="metric" id="app5000">-</div>
                    </div>
                </div>
            </div> <!-- //end cf-item -->
            
            <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>TOTAL APPS(10000) </p>
                </header>
                <div class="content">
                    <div class="cf-svmc-sparkline">
                        <div class="cf-svmc">
                            <div class="metric" id="app10000">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 cf-item">
                <header>
                    <p><span></span>TOTAL APPS(15000) </p>
                </header>
                <div class="content">
                    <div class="metric" id="app15000">-</div>
                </div>
            </div> <!-- //end cf-item -->
            
        </div> <!-- //end row -->
	
		
	</div> <!-- //end container -->

    <script src="../js/url.js"></script>
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="../js/moment.js"></script>
    <script src="../js/easypiechart.js"></script>
    <script src="../js/gauge.js"></script>
    <script src="../js/chart.js"></script>
    <script src="../js/jquery.sparklines.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/controlfrog-plugins.js"></script>
    <script src="../js/query-string.js"></script>
    <script>
        var themeColour = 'white';
    </script>
    <script src="../js/controlfrog.js"></script>

    <script>
   
   //This is the fucntion to get querysting, 
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }    
    
    var requestedHost=null;
    var requestedSdk=null;
    $(document).ready(function(){

        requestedHost = $.query.get('host');
        requestedSdk = $.query.get('sdk');

        if(!requestedHost)
            requestedHost=getParameterByName('host');

        if(!requestedSdk)
            requestedSdk=getParameterByName('sdk');       

        //getApiCount
        getApiCount(requestedHost,requestedSdk);
        //getActiveApps
        getActiveApps(requestedHost,requestedSdk);
        //getTopActiveAppsApiCount
        getTopActiveAppsApiCount(requestedHost,requestedSdk);
        //getTopActiveAppsApiFunnelCount
        getTopActiveAppsApiFunnelCount(requestedHost,requestedSdk);
        //getCategoryCount
        getCategoryCount(requestedHost,requestedSdk);
        //getLastWeekApiCount
        getLastWeekApiCount(requestedHost,requestedSdk);
        //getLastWeekApiFunnelCount
        getLastWeekApiFunnelCount(requestedHost,requestedSdk);
        //getLastActiveAppsCount
        getLastActiveAppsCount(requestedHost,requestedSdk);
        //apps5000
        apps5000(requestedHost,requestedSdk);
        //apps10000
        apps10000(requestedHost,requestedSdk);
        //apps15000
        apps15000(requestedHost,requestedSdk);        
    });

    
    //load total API count.
    function getApiCount(requestedHost,requestedSdk){       

        var data = {};
        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"api/count",
            data: data,
            type: "POST",
            success: function(response){
                var count = response.count;
                $("#apiCount").text(addCommas(count));
            },
            error: function(response){
                console.log(response);
            }
        });
    }
    
    //Get top active apps with API count.
    function getActiveApps(requestedHost,requestedSdk){
    
        var apiCount = 0;
        
        var aWeekAgo = new Date();
        var numberOfDays = 7;
        aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 

        var data = {"fromTime":aWeekAgo.getTime(),
                   "toTime" : new Date().getTime(),
                    "limit" : 5};

        data.host = requestedHost;
        data.sdk = requestedSdk;
        
        $.ajax({
            url: url+"app/active",
            data: data,
            type: "POST",
            success: function(response){
               var text ="";
               
               response.sort(function(a,b){return b.apiCount-a.apiCount});
                console.log(response);
                var funData =[];
                var funLabels = [];
                var funOptions = [];
                $('.cf-funnel').each(function(){
                    for(var i=0;i<response.length;i++) {
                        funData.push(response[i].apiCount);
                        funLabels.push(response[i].appId);
                        funOptions = {barOpacity: true};
                    }

                    cf_rFunnels[$(this).prop('id')] = new FunnelChart($(this).prop('id'), funData, funLabels, funOptions);
                });
               
            },
            error: function(response){
                console.log(response);
            }
        });   
    }

    //Get top active apps with API count.
    function getTopActiveAppsApiCount(requestedHost,requestedSdk){   

        var data = {};
        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"app/active/count",
            data: data,
            type: "POST",
            success: function(response){
                var count = response.count;
                $("#totalApps").text(addCommas(count));
            },
            error: function(response){
                console.log(response);
            }
        });
   
    }

    //Get top active apps with API count.
    function getTopActiveAppsApiFunnelCount(requestedHost,requestedSdk){   

        var data = {};
        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"app/funnel/count",
            data: data,
            type: "POST",
            success: function(response){
                var count = response.count;
                $("#funnelCount").text(addCommas(count));
            },
            error: function(response){
                console.log(response);
            }
        });
  
    }
    
    
    //Get category count.
    function getCategoryCount(requestedHost,requestedSdk){
    
        var apiCount = 0;

        var aWeekAgo = new Date();
        var numberOfDays = 7;
        aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
        
       var data = {"fromTime":aWeekAgo.getTime(),
                   "toTime" : new Date().getTime(),
                    "limit" : 5};

        data.host = requestedHost;
        data.sdk = requestedSdk;
        
        $.ajax({
            url: url+"category/api",
            data: data,
            type: "POST",
            success: function(response){
                var table = "<tr><th><b>NAME</b></th><th><b>REQUESTS</b></th></tr>";
                for(var i=0;i<response.length;i++){
                    table = table + "<tr><td>"+response[i].category.toUpperCase()+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>"+addCommas(response[i].apiCount)+"</td></tr>";
                }
                $("#svp-1").append(table);
            },
            error: function(response){
                console.log(response);
            }
        });    
    }

    //get last week API Count. 
    function getLastWeekApiCount(requestedHost,requestedSdk){
    
        var apiCount = 0;
        
        var aWeekAgo = new Date();
        var numberOfDays = 7;
        aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 

        var data = {"fromTime":aWeekAgo.getTime(),
                   "toTime" : new Date().getTime(),
                    "limit" : 5};

        data.host = requestedHost;
        data.sdk = requestedSdk;
        
        $.ajax({
            url: url+"api/count",
            data: data,
            type: "POST",
            success: function(response){
                var count = response.count;
                $("#lastWeekAPI").text(addCommas(count));
                
                //get previous week api count to calculate growth rate. 
                var twoWeeksAgo = new Date(aWeekAgo);
                var numberOfDays = 7;
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - numberOfDays); 
                
                var data = {"fromTime":twoWeeksAgo.getTime(),
                            "toTime" : aWeekAgo.getTime()};

                data.host = requestedHost;
                data.sdk = requestedSdk;          

                $.ajax({
                    url: url+"api/count",
                    data: data,
                    type: "POST",
                    success: function(response){
                       var lastWeek = response.count; 
                       var thisWeek = count;
                       
                       //calculate growth rate. 
                       var growth = ((thisWeek - lastWeek)/lastWeek)*100;
                       
                       //round to 1 decimal place. 
                       var finalNumber = Math.round( growth * 10) / 10;
                       
                       $("#apiGrowthRate").text(finalNumber+"%");
                    },
                    error: function(response){
                        console.log(response);
                    }
                });
                
            },
            error: function(response){
                console.log(response);
            }
        });
    
    }

    //get last week API Count. 
    function getLastWeekApiFunnelCount(requestedHost,requestedSdk){
    
        var apiCount = 0;
        
        var aWeekAgo = new Date();
        var numberOfDays = 7;
        aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
        
        var data = {"fromTime":aWeekAgo.getTime(),
                    "toTime" : new Date().getTime()};

        data.host = requestedHost;
        data.sdk = requestedSdk;;

        $.ajax({
            url: url+"app/funnel/count",
            data: data,
            type: "POST",
            success: function(response){
                var count = response.count;
                $("#lastWeekFunnelCount").text(addCommas(count));
                
                //get previous week api count to calculate growth rate. 
                var twoWeeksAgo = new Date(aWeekAgo);
                var numberOfDays = 7;
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - numberOfDays); 
                

                var data = {"fromTime":twoWeeksAgo.getTime(),
                            "toTime" : aWeekAgo.getTime()};

                data.host = requestedHost;
                data.sdk = requestedSdk;

                $.ajax({
                    url: url+"app/funnel/count",
                    data: data,
                    type: "POST",
                    success: function(response){
                       var lastWeek = response.count; 
                       var thisWeek = count;
                       
                       //calculate growth rate. 
                       var growth = ((thisWeek - lastWeek)/lastWeek)*100;
                       
                       //round to 1 decimal place. 
                       var finalNumber = Math.round( growth * 10) / 10;
                       
                       $("#funnelGrowthRate").text(finalNumber+"%");
                    },
                    error: function(response){
                        console.log(response);
                    }
                });
                
            },
            error: function(response){
                console.log(response);
            }
        });
   
    }

    //get last active apps count. 
    function getLastActiveAppsCount(requestedHost,requestedSdk){
    
        var apiCount = 0;
        
        var aWeekAgo = new Date();
        var numberOfDays = 7;
        aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
        
        var data = {"fromTime":aWeekAgo.getTime(),
                    "toTime" : new Date().getTime()};

        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"app/active/count",
            data: data,
            type: "POST",
            success: function(response){
                var count = response.count;
                $("#activeApps").text(addCommas(count));
                
                //get previous week api count to calculate growth rate. 
                var twoWeeksAgo = new Date(aWeekAgo);
                var numberOfDays = 7;
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - numberOfDays); 
                

                var data = {"fromTime":twoWeeksAgo.getTime(),
                            "toTime" : aWeekAgo.getTime()};

                data.host = requestedHost;
                data.sdk = requestedSdk;

                $.ajax({
                    url: url+"app/active/count",
                    data: data,
                    type: "POST",
                    success: function(response){
                       var lastWeek = response.count; 
                       var thisWeek = count;
                       
                       //calculate growth rate. 
                       var growth = ((thisWeek - lastWeek)/lastWeek)*100;
                       
                       //round to 1 decimal place. 
                       var finalNumber = Math.round( growth * 10) / 10;
                       
                       $("#appGrowthRate").text(finalNumber+"%");
                    },
                    error: function(response){
                        console.log(response);
                    }
                });
                
            },
            error: function(response){
                console.log(response);
            }
        });
    
    }

    //Get Total number of apps which crossed 5000 calls.
    function apps5000(requestedHost,requestedSdk){  
    
        var data = {};
        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"api/calls/5000", 
            data: data,               
            type: "POST",
            success: function(response){
                $("#app5000").text(response);
            },
            error: function(response){
                console.log(response);
            }
        });
    
    }
    
    //Get Total number of apps which crossed 10000 calls.
    function apps10000(requestedHost,requestedSdk){

        var data = {};
        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"api/calls/10000",
            data: data,                
            type: "POST",
            success: function(response){
                $("#app10000").text(response);
            },
            error: function(response){
                console.log(response);
            }
        });   
    }

    //Get Total number of apps which crossed 15000 calls.
    function apps15000(requestedHost,requestedSdk){

        var data = {};
        data.host = requestedHost;
        data.sdk = requestedSdk;

        $.ajax({
            url: url+"api/calls/15000", 
            data: data,               
            type: "POST",
            success: function(response){
               $("#app15000").text(response); 
            },
            error: function(response){
                console.log(response);
            }
        });
    }
    </script>

</body>

</html>






