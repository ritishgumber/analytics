<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>CB Metrics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/controlfrog.css" rel="stylesheet" media="screen">
	<!--<link href="http://leapfrogui.com/controlfrog-v1.4/cf/favicon.ico" rel="shortcut icon" type="image/x-icon" />-->
	<script src="../js/url.js"></script>
	<script src="../js/jquery-1.9.1.min.js"></script>
	<script src="../js/moment.js"></script>
	<script src="../js/easypiechart.js"></script>
	<script src="../js/gauge.js"></script>
	<script src="../js/chart.js"></script>
	<script src="../js/jquery.sparklines.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/controlfrog-plugins.js"></script>
    
    <!--[if lt IE 9]>
		<script src="../js/respond.min.js"></script>
		<script src="../js/excanvas.min.js"></script>
	<![endif]-->
    
    
	<script>
		var themeColour = 'white';
	</script>
    <script src="../js/controlfrog.js"></script>
</head>
<body class="black">
	
	<div class="cf-nav cf-nav-state-min">
		<a href="#" class="cf-nav-toggle">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</a>
		
		<ul>
			<li class="cf-nav-shortcut">
				<a href="index.html">
					<span class="cf-nav-min">1</span>
					<span class="cf-nav-max">Last Week Data</span>
				</a>
			</li>
		</ul>
	</div>
	
	<div class="cf-container cf-nav-active">

		<div class="row">
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Total API Count</p>
				</header>
				<div class="content">
					<div class="cf-svmc-sparkline">
						<div class="cf-svmc">
							<div class="metric" id="apiCount">-</div>
							<div class="change m-green metric-small">
							</div>
						</div>
						
					</div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>API Count - Last 7 days.</p>
				</header>
				<div class="content">
					<div class="cf-svmc-sparkline">
						<div class="cf-svmc">
							<div class="metric" id="lastWeekAPI">-</div>
							<div class="change m-green metric-small">
							</div>
						</div>
						
					</div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
<header>
	<p><span></span>Server Date and Time.</p>
</header>
<div class="content">
	<div class="cf-td">
	<!-- <div class="cf-td cf-td-12">-->
		<div class="cf-td-time metric">12:00</div>
		<div class="cf-td-dd">
			<p class="cf-td-day metric-small">Monday</p>
			<p class="cf-td-date metric-small">1st October, 2013</p>
		</div>
	</div>
</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Active Apps last week.</p>
				</header>
				<div class="content">
					<div class="cf-svmc">
						<div class="metric" id="activeApps">-</div>
					</div>
				</div>
			</div> <!-- //end cf-item -->
		</div> <!-- //end row -->
	
		<div class="row">
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>API GROWTH RATE - LAST WEEK</p>
				</header>
				<div class="content">
					<div class="cf-svmc-sparkline">
						<div class="cf-svmc">
							<div class="metric" id="apiGrowthRate">-</div>
							<div class="change m-green metric-small">
							</div>
						</div>
						
					</div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>ACTIVE APPS GROWTH RATE - LAST WEEK</p>
				</header>
				<div class="content">
					<div class="cf-svmc-sparkline">
						<div class="cf-svmc">
							<div class="metric" id="appGrowthRate">-</div>
							</div>
						</div>
					</div>
				</div>
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Top Active Apps</p>
				</header>
                <div class="content">
					<div id="cf-funnel-1" class="cf-funnel"></div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Method Wise Stats</p>
				</header>
				<div class="content cf-svp clearfix" id="svp-1">
				</div>
			</div>
		</div>
	</div> <!-- //end container -->

    <script>
        //load total API count.
        $(document).ready(function(){
            var apiCount = 0;
            
            $.ajax({
                url: url+"api/count",
                data: {},
                type: "POST",
                success: function(response){
                    var count = response.count;
                    $("#apiCount").text(addCommas(count));
                },
                error: function(response){
                    console.log(response);
                }
            });
        });
        
        //Get top active apps with API count.
        $(document).ready(function(){
            var apiCount = 0;
            
            var aWeekAgo = new Date();
            var numberOfDays = 7;
            aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
            
            $.ajax({
                url: url+"app/active",
                data: {"fromTime":aWeekAgo.getTime(),
                       "toTime" : new Date().getTime(),
                        "limit" : 5},
                type: "POST",
                success: function(response){
                   var text ="";
                   
                   response.sort(function(a,b){return b.apiCount-a.apiCount});
                    console.log(response);
                    var funData =[];
                    var funLabels = [];
                    var funOptions = [];
                    $('.cf-funnel').each(function(){
                        for(var i=0;i<response.length;i++) {
                            funData.push(response[i].apiCount);
                            funLabels.push(response[i].appId);
                            funOptions = {barOpacity: true};
                        }

                        cf_rFunnels[$(this).prop('id')] = new FunnelChart($(this).prop('id'), funData, funLabels, funOptions);
                    });
                   
                },
                error: function(response){
                    console.log(response);
                }
            });
        });
        
        //Get category count.
        $(document).ready(function(){
            var apiCount = 0;
            
            var aWeekAgo = new Date();
            var numberOfDays = 7;
            aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
            
            $.ajax({
                url: url+"category/api",
                data: {"fromTime":aWeekAgo.getTime(),
                       "toTime" : new Date().getTime(),
                        },
                type: "POST",
                success: function(response){
                    var table = "<tr><th>Name</th><th>Requests</th></tr>";
                    for(var i=0;i<response.length;i++){
                        table = table + "<tr><td>"+response[i].category.toUpperCase()+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>"+addCommas(response[i].apiCount)+"</td></tr>";
                    }
                    $("#svp-1").append(table);
                },
                error: function(response){
                    console.log(response);
                }
            });
        });

        //get last week API Count. 
        $(document).ready(function(){
            var apiCount = 0;
            
            var aWeekAgo = new Date();
            var numberOfDays = 7;
            aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
            
            $.ajax({
                url: url+"api/count",
                data: {"fromTime":aWeekAgo.getTime(),
                        "toTime" : new Date().getTime()},
                type: "POST",
                success: function(response){
                    var count = response.count;
                    $("#lastWeekAPI").text(count);
                    
                    //get previous week api count to calculate growth rate. 
                    var twoWeeksAgo = new Date(aWeekAgo);
                    var numberOfDays = 7;
                    twoWeeksAgo.setDate(twoWeeksAgo.getDate() - numberOfDays); 
                    
                    $.ajax({
                        url: url+"api/count",
                        data: {"fromTime":twoWeeksAgo.getTime(),
                                "toTime" : aWeekAgo.getTime()},
                        type: "POST",
                        success: function(response){
                           var lastWeek = response.count; 
                           var thisWeek = count;
                           
                           //calculate growth rate. 
                           var growth = ((thisWeek - lastWeek)/lastWeek)*100;
                           
                           //round to 1 decimal place. 
                           var finalNumber = Math.round( growth * 10) / 10;
                           
                           $("#apiGrowthRate").text(finalNumber+"%");
                        },
                        error: function(response){
                            console.log(response);
                        }
                    });
                    
                },
                error: function(response){
                    console.log(response);
                }
            });
        });


        //get last active apps count. 
        $(document).ready(function(){
            var apiCount = 0;
            
            var aWeekAgo = new Date();
            var numberOfDays = 7;
            aWeekAgo.setDate(aWeekAgo.getDate() - numberOfDays); 
            
            $.ajax({
                url: url+"app/active/count",
                data: {"fromTime":aWeekAgo.getTime(),
                        "toTime" : new Date().getTime()},
                type: "POST",
                success: function(response){
                    var count = response.count;
                    $("#activeApps").text(count);
                    
                    //get previous week api count to calculate growth rate. 
                    var twoWeeksAgo = new Date(aWeekAgo);
                    var numberOfDays = 7;
                    twoWeeksAgo.setDate(twoWeeksAgo.getDate() - numberOfDays); 
                    
                    $.ajax({
                        url: url+"app/active/count",
                        data: {"fromTime":twoWeeksAgo.getTime(),
                                "toTime" : aWeekAgo.getTime()},
                        type: "POST",
                        success: function(response){
                           var lastWeek = response.count; 
                           var thisWeek = count;
                           
                           //calculate growth rate. 
                           var growth = ((thisWeek - lastWeek)/lastWeek)*100;
                           
                           //round to 1 decimal place. 
                           var finalNumber = Math.round( growth * 10) / 10;
                           
                           $("#appGrowthRate").text(finalNumber+"%");
                        },
                        error: function(response){
                            console.log(response);
                        }
                    });
                    
                },
                error: function(response){
                    console.log(response);
                }
            });
        });
        
    </script>

</body>

</html>






